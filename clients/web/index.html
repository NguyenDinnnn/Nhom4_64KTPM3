<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>á»¨NG Dá»¤NG Há»ŒC TÄ‚NG CÆ¯á»œNG TRONG VIá»†C Tá»I Æ¯U HÃ“A ÄÆ¯á»œNG ÄI Cá»¦A ROBOT</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="main-container">
Â  Â  <div class="left-column">
Â  Â  Â  Â  <div class="card simulation-card">
Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-icon">ğŸ¤–</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-title">MÃ´i TrÆ°á»ng MÃ´ Phá»ng</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span style="margin-left: auto; background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 10px; font-size: 12px;">Sáºµn sÃ ng</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="grid-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid" id="grid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-color robot">ğŸ¤–</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Robot</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-color goal"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Má»¥c tiÃªu</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-color obstacle"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Váº­t cáº£n</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="legend-color waypoint"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Äiá»ƒm trung gian</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div id="msg" class="status-message">MÃ´i trÆ°á»ng Ä‘Ã£ Ä‘Æ°á»£c reset</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="right-column">
Â  Â  Â  Â  <div class="card combined-control-card">
Â  Â  Â  Â  Â  Â  <div class="combined-content">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="control-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-icon">ğŸ®</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-title">Äiá»u Khiá»ƒn Robot</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-start" onclick="startAutoMove()">â–¶ Auto Move</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-stop" onclick="stopAll()">ğŸ›‘ Stop</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="button-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-reset" onclick="resetGrid()">ğŸ”„ Reset</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-debug" onclick="toggleDebug()">ğŸ”§ Debug</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="manualControls" class="manual-controls" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align:center; margin-bottom:10px;">Äiá»u khiá»ƒn thá»§ cÃ´ng</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="direction-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-debug" onclick="manualMove('up')">â†‘</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-debug" onclick="manualMove('right')">â†’</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-debug" onclick="manualMove('down')">â†“</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-debug" onclick="manualMove('left')">â†</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="algorithm-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="section-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-icon">ğŸ§ </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-title">Thuáº­t ToÃ¡n Há»c TÄƒng CÆ°á»ng</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="algorithm-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-algorithm" onclick="runAlgorithm('MC')">Monte Carlo</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-algorithm" onclick="runAlgorithm('Q-learning')">Q-Learning</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-algorithm" onclick="runAlgorithm('A2C')">A2C</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-algorithm" onclick="runAStar()">A*</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card stats-card">
Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-icon">ğŸ“Š</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-title">Thá»‘ng KÃª Hiá»‡u Suáº¥t</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="stats-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">THUáº¬T TOÃN</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="current-algorithm">-</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">REWARD</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="current-reward">-</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">STEP</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="current-steps">-</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">WAYPOINTS</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="current-waypoints">-</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-label">THá»œI GIAN</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-value" id="current-time">-</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div id="algoResult" class="algo-result" style="display:none;"></div>

Â  Â  Â  Â  Â  Â  <canvas id="trajectory" width="300" height="240" style="border:1px solid #ccc; margin-top:10px;"></canvas>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card stats-card">
Â  Â  Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-icon">ğŸ“ˆ</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="card-title">Reward theo Step</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <canvas id="rewardChart" width="300" height="240"></canvas>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ---------------- Biáº¿n toÃ n cá»¥c ----------------
let gridSizeX = 10, gridSizeY = 8;
let robotPos = [0, 0], goal = [9, 7], obstacles = [], waypoints = [], visitedWaypoints = [];
let autoMoving = false, algoMoving = false, intervalId = null, debugMode = false, currentAlgo = null;
let startTime = null, endTime = null, trajectoryPoints = [];
let allAlgoData = {};
let currentAlgoData = { rewards: [], totalReward: 0 }; // Biáº¿n má»›i Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u cá»§a thuáº­t toÃ¡n Ä‘ang cháº¡y

// ---------------- Chart ----------------
const ctx = document.getElementById('rewardChart').getContext('2d');
const rewardChart = new Chart(ctx, {
Â  Â  type: 'line',
Â  Â  data: { labels: [], datasets: [] },
Â  Â  options: {
Â  Â  Â  Â  responsive:true,
Â  Â  Â  Â  plugins:{ title:{ display:true, text:'Reward theo Step' } },
Â  Â  Â  Â  scales:{ x:{ title:{ display:true, text:'Step' } }, y:{ title:{ display:true, text:'Reward' } } }
Â  Â  }
});

function randomColor(alpha=1){
Â  Â  const r=Math.floor(Math.random()*255), g=Math.floor(Math.random()*255), b=Math.floor(Math.random()*255);
Â  Â  return `rgba(${r},${g},${b},${alpha})`;
}

function updateChart() {
Â  Â  rewardChart.data.datasets = [];
Â  Â  let maxSteps = 0;
Â  Â  
Â  Â  for (const algo in allAlgoData) {
Â  Â  Â  Â  if (allAlgoData[algo].rewards.length > maxSteps) {
Â  Â  Â  Â  Â  Â  maxSteps = allAlgoData[algo].rewards.length;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  rewardChart.data.labels = Array.from({length: maxSteps}, (_, i) => i + 1);

Â  Â  for (const algo in allAlgoData) {
Â  Â  Â  Â  rewardChart.data.datasets.push({
Â  Â  Â  Â  Â  Â  label: algo,
Â  Â  Â  Â  Â  Â  data: allAlgoData[algo].rewards,
Â  Â  Â  Â  Â  Â  borderColor: allAlgoData[algo].color,
Â  Â  Â  Â  Â  Â  backgroundColor: allAlgoData[algo].color.replace('rgb', 'rgba').replace(')', ', 0.2)'),
Â  Â  Â  Â  Â  Â  fill: false,
Â  Â  Â  Â  Â  Â  tension: 0.3,
Â  Â  Â  Â  Â  Â  pointRadius: 0
Â  Â  Â  Â  });
Â  Â  }
Â  Â  rewardChart.update();
}

// ---------------- Grid & Robot ----------------
function drawGridOnce(){
Â  Â  let grid=document.getElementById("grid");
Â  Â  grid.style.gridTemplateColumns=`repeat(${gridSizeX},35px)`;
Â  Â  grid.innerHTML="";
Â  Â  for(let y=0;y<gridSizeY;y++){
Â  Â  Â  Â  for(let x=0;x<gridSizeX;x++){
Â  Â  Â  Â  Â  Â  let cell=document.createElement("div");
Â  Â  Â  Â  Â  Â  cell.classList.add("cell");
Â  Â  Â  Â  Â  Â  cell.dataset.x=x; cell.dataset.y=y;
Â  Â  Â  Â  Â  Â  if(obstacles.some(o=>o[0]===x&&o[1]===y)) cell.classList.add("obstacle");
Â  Â  Â  Â  Â  Â  if(waypoints.some(w=>w[0]===x&&w[1]===y && !visitedWaypoints.some(vw=>vw[0]===w[0] && vw[1]===w[1]))) cell.classList.add("waypoint");
Â  Â  Â  Â  Â  Â  if(x===goal[0]&&y===goal[1]) cell.classList.add("goal");
Â  Â  Â  Â  Â  Â  if(x===robotPos[0]&&y===robotPos[1]) { cell.classList.add("robot"); cell.innerHTML="ğŸ¤–"; }
Â  Â  Â  Â  Â  Â  grid.appendChild(cell);
Â  Â  Â  Â  }
Â  Â  }
}

function updateRobot(prevPos, newPos){
Â  Â  let grid=document.getElementById("grid");
Â  Â  let oldCell=grid.querySelector(`.cell[data-x='${prevPos[0]}'][data-y='${prevPos[1]}']`);
Â  Â  if(oldCell){ oldCell.classList.remove("robot"); oldCell.innerHTML=""; }
Â  Â  let newCell=grid.querySelector(`.cell[data-x='${newPos[0]}'][data-y='${newPos[1]}']`);
Â  Â  if(newCell){ newCell.classList.add("robot"); newCell.innerHTML="ğŸ¤–"; }
Â  Â  trajectoryPoints.push([...newPos]);

Â  Â  if(newPos[0]===goal[0] && newPos[1]===goal[1]){
Â  Â  Â  Â  endTime = performance.now();
Â  Â  Â  Â  let elapsed = ((endTime - startTime)/1000).toFixed(2);
Â  Â  Â  Â  document.getElementById("current-time").innerText = elapsed + " s";
Â  Â  Â  Â  drawTrajectory();
Â  Â  }

Â  Â  waypoints.forEach(w=>{
Â  Â  Â  Â  if(w[0]===newPos[0] && w[1]===newPos[1]){
Â  Â  Â  Â  Â  Â  newCell.classList.remove("waypoint"); newCell.classList.add("visited"); newCell.innerHTML="ğŸ¤–";
Â  Â  Â  Â  Â  Â  if(!visitedWaypoints.some(vw=>vw[0]===w[0] && vw[1]===w[1])) visitedWaypoints.push([w[0],w[1]]);
Â  Â  Â  Â  }
Â  Â  });
}

// ---------------- Manual & Debug ----------------
async function manualMove(dir){
Â  Â  if(!debugMode) return;
Â  Â  let prevPos = [...robotPos];
Â  Â  let resp = await fetch("/step",{
Â  Â  Â  Â  method:"POST",
Â  Â  Â  Â  headers:{"Content-Type":"application/json"},
Â  Â  Â  Â  body:JSON.stringify({action_name:dir})
Â  Â  });
Â  Â  let data=await resp.json();
Â  Â  if(!data.error){
Â  Â  Â  Â  robotPos = data.state;
Â  Â  Â  Â  visitedWaypoints = data.visited_waypoints || [];
Â  Â  Â  Â  updateRobot(prevPos, robotPos);
Â  Â  }
}

function toggleDebug(){
Â  Â  debugMode = !debugMode;
Â  Â  document.getElementById("manualControls").style.display = debugMode?"block":"none";
}

// ---------------- Auto Move ----------------
async function autoStep(){
Â  Â  let prevPos=[...robotPos];
Â  Â  let resp = await fetch("/state");
Â  Â  let data = await resp.json();
Â  Â  robotPos = data.state;
Â  Â  visitedWaypoints = data.visited_waypoints || [];
Â  Â  updateRobot(prevPos, robotPos);
}

function startAutoMove(){
Â  Â  if(autoMoving) return;
Â  Â  autoMoving = true; algoMoving=false;
Â  Â  startTime = performance.now();
Â  Â  trajectoryPoints = [[...robotPos]];
Â  Â  intervalId = setInterval(autoStep, 300);
Â  Â  document.getElementById("msg").innerText = "Auto move báº¯t Ä‘áº§u";
}

function stopAll(){
Â  Â  autoMoving=false; algoMoving=false; currentAlgo=null;
Â  Â  if(intervalId) clearInterval(intervalId);
Â  Â  intervalId=null;
Â  Â  document.getElementById("msg").innerText="ÄÃ£ dá»«ng robot";
Â  Â  document.getElementById("algoResult").style.display = "none";
}

// ---------------- Reset ----------------
async function resetGrid(){
Â  Â  stopAll();
Â  Â  let resp = await fetch("/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:"{}"});
Â  Â  let data = await resp.json();
Â  Â  robotPos=data.state; goal=data.map.goal; obstacles=data.map.obstacles; waypoints=data.map.waypoints||[];
Â  Â  visitedWaypoints=[]; gridSizeX=data.map.width; gridSizeY=data.map.height;
Â  Â  drawGridOnce(); updateRobot([0,0], robotPos);
Â  Â  document.getElementById("msg").innerText="MÃ´i trÆ°á»ng Ä‘Ã£ Ä‘Æ°á»£c reset";
Â  Â  document.getElementById("current-time").innerText="-";
Â  Â  trajectoryPoints=[]; clearTrajectory();
}

// ---------------- Run RL Algorithms step-by-step ----------------
async function runAlgorithm(algo){
Â  Â  stopAll();
Â  Â  currentAlgo = algo;
Â  Â  allAlgoData[algo] = { rewards: [], color: randomColor() };
Â  Â  let totalReward = 0;
Â  Â  let steps = 0;
Â  Â  
Â  Â  const resultDiv = document.getElementById("algoResult");
Â  Â  resultDiv.style.display = "block";
Â  Â  resultDiv.innerHTML = `<div class="loading"></div> Äang cháº¡y thuáº­t toÃ¡n ${algo}...`;

Â  Â  // Reset tráº¡ng thÃ¡i trÆ°á»›c khi cháº¡y
Â  Â  await resetGrid();
Â  Â  
Â  Â  // Báº¯t Ä‘áº§u vÃ²ng láº·p tá»«ng bÆ°á»›c
Â  Â  intervalId = setInterval(async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  let prevPos = [...robotPos];
Â  Â  Â  Â  Â  Â  const resp = await fetch("/step_algorithm", {
Â  Â  Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ algorithm: algo })
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  const data = await resp.json();

Â  Â  Â  Â  Â  Â  if (data.error) {
Â  Â  Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = `âŒ Lá»—i: ${data.error}`;
Â  Â  Â  Â  Â  Â  Â  Â  stopAll();
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  robotPos = data.state;
Â  Â  Â  Â  Â  Â  visitedWaypoints = data.visited_waypoints || [];
Â  Â  Â  Â  Â  Â  updateRobot(prevPos, robotPos);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  totalReward += data.reward;
Â  Â  Â  Â  Â  Â  steps = data.steps;
Â  Â  Â  Â  Â  Â  allAlgoData[algo].rewards.push(totalReward);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  updateStats(
Â  Â  Â  Â  Â  Â  Â  Â  algo,
Â  Â  Â  Â  Â  Â  Â  Â  totalReward.toFixed(1),
Â  Â  Â  Â  Â  Â  Â  Â  steps,
Â  Â  Â  Â  Â  Â  Â  Â  `${visitedWaypoints.length}/${waypoints.length}`
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  if (data.done) {
Â  Â  Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  âœ… <strong>${algo}</strong><br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¯ Reward: ${totalReward.toFixed(1)}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ‘£ Steps: ${steps}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“ Waypoints: ${visitedWaypoints.length}/${waypoints.length}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ† <strong>Robot Ä‘Ã£ Ä‘áº¿n Ä‘Ã­ch!</strong>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  stopAll();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = `<div class="loading"></div> Äang cháº¡y thuáº­t toÃ¡n ${algo}...`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateChart();
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = "âŒ CÃ³ lá»—i xáº£y ra khi cháº¡y thuáº­t toÃ¡n";
Â  Â  Â  Â  Â  Â  stopAll();
Â  Â  Â  Â  }
Â  Â  }, 200); // Tá»‘c Ä‘á»™ di chuyá»ƒn: 200ms má»—i bÆ°á»›c
}

// ---------------- Run A* (unchanged, váº«n hoáº¡t Ä‘á»™ng tá»‘t) ----------------
async function runAStar(){
Â  Â  stopAll(); currentAlgo="A*";
Â  Â  const resultDiv = document.getElementById("algoResult");
Â  Â  resultDiv.style.display = "block";
Â  Â  resultDiv.innerHTML = `<div class="loading"></div> Äang cháº¡y thuáº­t toÃ¡n A*...`;

Â  Â  try{
Â  Â  Â  Â  let prevPos = [...robotPos];
Â  Â  Â  Â  const resp = await fetch("/run_a_star",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});
Â  Â  Â  Â  const data = await resp.json();
Â  Â  Â  Â  if(data.error){ resultDiv.innerHTML = `âŒ Lá»—i: ${data.error}`; return; }
Â  Â  Â  Â  
Â  Â  Â  Â  allAlgoData[data.algorithm] = { rewards: data.rewards_over_time, color: randomColor() };

Â  Â  Â  Â  let path = data.path;
Â  Â  Â  Â  for(let i=1;i<path.length;i++){
Â  Â  Â  Â  Â  Â  await new Promise(r=>setTimeout(r,200));
Â  Â  Â  Â  Â  Â  prevPos = [...robotPos];
Â  Â  Â  Â  Â  Â  robotPos = path[i];
Â  Â  Â  Â  Â  Â  visitedWaypoints = data.visited_waypoints||[];
Â  Â  Â  Â  Â  Â  updateRobot(prevPos, robotPos);
Â  Â  Â  Â  }

Â  Â  Â  Â  updateStats(
Â  Â  Â  Â  Â  Â  data.algorithm,
Â  Â  Â  Â  Â  Â  data.reward.toFixed(1),
Â  Â  Â  Â  Â  Â  data.steps,
Â  Â  Â  Â  Â  Â  `${data.visited_waypoints.length}/${waypoints.length}`
Â  Â  Â  Â  );

Â  Â  Â  Â  resultDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  âœ… <strong>${data.algorithm}</strong><br>
Â  Â  Â  Â  Â  Â  ğŸ¯ Reward: ${data.reward.toFixed(1)}<br>
Â  Â  Â  Â  Â  Â  ğŸ‘£ Steps: ${data.steps}<br>
Â  Â  Â  Â  Â  Â  ğŸ“ Waypoints: ${data.visited_waypoints.length}/${waypoints.length}<br>
Â  Â  Â  Â  Â  Â  ${data.done ? "ğŸ† <strong>Robot Ä‘Ã£ Ä‘áº¿n Ä‘Ã­ch!</strong>" : ""}
Â  Â  Â  Â  `;

Â  Â  Â  Â  updateChart();
Â  Â  } catch(e){
Â  Â  Â  Â  console.error(e); 
Â  Â  Â  Â  resultDiv.innerHTML = "âŒ CÃ³ lá»—i xáº£y ra khi cháº¡y A*";
Â  Â  }
}

// ---------------- Draw & Clear Trajectory ----------------
function drawTrajectory(){
Â  Â  let canvas=document.getElementById("trajectory");
Â  Â  let ctx=canvas.getContext("2d");
Â  Â  clearTrajectory();
Â  Â  if(trajectoryPoints.length<2) return;
Â  Â  ctx.beginPath();
Â  Â  let scaleX=canvas.width/gridSizeX, scaleY=canvas.height/gridSizeY;
Â  Â  ctx.moveTo(trajectoryPoints[0][0]*scaleX+scaleX/2, trajectoryPoints[0][1]*scaleY+scaleY/2);
Â  Â  for(let i=1;i<trajectoryPoints.length;i++){
Â  Â  Â  Â  ctx.lineTo(trajectoryPoints[i][0]*scaleX+scaleX/2, trajectoryPoints[i][1]*scaleY+scaleY/2);
Â  Â  }
Â  Â  ctx.strokeStyle="red"; ctx.lineWidth=2; ctx.stroke();
}

function clearTrajectory(){
Â  Â  let canvas=document.getElementById("trajectory");
Â  Â  let ctx=canvas.getContext("2d");
Â  Â  ctx.clearRect(0,0,canvas.width,canvas.height);
}

// ---------------- Update Stats ----------------
function updateStats(algo, reward, steps, wp){
Â  Â  document.getElementById("current-algorithm").innerText = algo;
Â  Â  document.getElementById("current-reward").innerText = reward;
Â  Â  document.getElementById("current-steps").innerText = steps;
Â  Â  document.getElementById("current-waypoints").innerText = wp;
}

// ---------------- Khá»Ÿi táº¡o ----------------
resetGrid();
</script>

</body>
</html>